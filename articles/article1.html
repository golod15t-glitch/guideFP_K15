<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Статья</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap");
    body {
      font-family: "Inter", sans-serif;
      background-color: #f8fafc;
      color: #1e293b;
      line-height: 1.6;
      margin: 0;
      padding: 0;
    }
    .content-editable {
      min-height: 300px;
      outline: none;
      padding: 1rem;
      border-radius: 0.5rem;
      border: 1px solid transparent;
      transition: border-color 0.3s;
      position: relative;
      background-color: white;
    }
    .content-editable[contenteditable="true"] {
      border-color: #4f46e5;
      background-color: #ffffff;
    }
    /* Стиль для плейсхолдера */
    .content-editable.empty::before {
      content: attr(data-placeholder);
      position: absolute;
      top: 1rem;
      left: 1rem;
      right: 1rem;
      color: #94a3b8; /* серый цвет */
      pointer-events: none;
      user-select: none;
      white-space: pre-wrap;
    }
    .editor-toolbar {
      background: #fff;
      border-bottom: 1px solid #e5e7eb;
      padding: 0.5rem;
      display: none;
      gap: 0.5rem;
      align-items: center;
      flex-wrap: wrap;
    }
    .editor-toolbar.active {
      display: flex;
    }
    .tool-btn {
      cursor: pointer;
      padding: 0.25rem 0.5rem;
      border-radius: 0.375rem;
      border: 1px solid transparent;
      transition: background-color 0.2s, border-color 0.2s;
      background: #e0e7ff;
      color: #4338ca;
      font-size: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .tool-btn:hover {
      background-color: #c7d2fe;
      border-color: #4338ca;
    }
    .font-size-display {
      padding: 0.25rem 0.5rem;
      border-radius: 0.375rem;
      border: 1px solid transparent;
      background: #e0e7ff;
      color: #4338ca;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.2s, border-color 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 60px;
      text-align: center;
    }
    .font-size-display:hover {
      background-color: #c7d2fe;
      border-color: #4338ca;
    }
    .font-size-display input {
      border: none;
      background: transparent;
      color: #4338ca;
      font-size: 1rem;
      text-align: center;
      width: 100%;
      outline: none;
    }
    select.font-select {
      font-size: 1rem;
      padding: 0.25rem 0.5rem;
      border-radius: 0.375rem;
      border: 1px solid transparent;
      background: #e0e7ff;
      color: #4338ca;
      cursor: pointer;
      transition: background-color 0.2s, border-color 0.2s;
      font-family: inherit;
    }
    select.font-select:hover {
      background-color: #c7d2fe;
      border-color: #4338ca;
    }
    #adminModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    #adminModal.active {
      visibility: visible;
      opacity: 1;
    }
    #adminModal .modal-content {
      background: white;
      padding: 1.5rem;
      border-radius: 0.75rem;
      max-width: 400px;
      width: 100%;
      box-sizing: border-box;
    }
    #adminError {
      color: red;
      margin-top: 0.5rem;
      display: none;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <!-- Админский модал -->
  <div id="adminModal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="adminModalTitle">
      <h2 id="adminModalTitle">Доступ к редактированию</h2>
      <p>Введите код доступа администратора:</p>
      <input
        id="adminCodeInput"
        type="password"
        placeholder="Код доступа"
        autocomplete="off"
        style="width: 100%; padding: 0.5rem; margin-top: 0.5rem; font-size: 1rem;"
        aria-describedby="adminError"
      />
      <div id="adminError" role="alert">Неверный код!</div>
      <button id="adminSubmitBtn" style="margin-top: 1rem; width: 100%; padding: 0.5rem; font-size: 1rem;">
        Подтвердить
      </button>
    </div>
  </div>
  <!-- Панель инструментов редактора -->
  <div id="editorToolbar" class="editor-toolbar" aria-label="Панель инструментов редактора">
    <button class="tool-btn" title="Жирный" onclick="formatText('bold')" type="button" aria-pressed="false"><i class="fas fa-bold"></i></button>
    <button class="tool-btn" title="Курсив" onclick="formatText('italic')" type="button" aria-pressed="false"><i class="fas fa-italic"></i></button>
    <button class="tool-btn" title="Подчёркивание" onclick="formatText('underline')" type="button" aria-pressed="false"><i class="fas fa-underline"></i></button>
    <button class="tool-btn" title="Маркированный список" onclick="formatText('insertUnorderedList')" type="button" aria-pressed="false"><i class="fas fa-list-ul"></i></button>
    <button class="tool-btn" title="Нумерованный список" onclick="formatText('insertOrderedList')" type="button" aria-pressed="false"><i class="fas fa-list-ol"></i></button>
    <button class="tool-btn" title="Вставить изображение" onclick="addImage()" type="button"><i class="fas fa-image"></i></button>

    <!-- Поле для отображения и ввода размера шрифта -->
    <div class="font-size-display" id="fontSizeDisplay" onclick="makeFontSizeEditable()">
      <input type="text" id="fontSizeInput" value="16" readonly style="cursor: pointer;" onblur="applyFontSize()" onkeydown="handleFontSizeKeyDown(event)">
    </div>

    <!-- Выпадающий список шрифтов -->
    <select class="font-select" aria-label="Выбор шрифта" onchange="formatText('fontName', this.value)">
      <option value="" selected>Шрифт</option>
      <option value="Arial">Arial</option>
      <option value="'Times New Roman', Times, serif">Times New Roman</option>
      <option value="'Courier New', Courier, monospace">Courier New</option>
      <option value="Verdana">Verdana</option>
      <option value="Georgia">Georgia</option>
      <option value="Impact">Impact</option>
      <option value="Tahoma">Tahoma</option>
      <option value="Comic Sans MS">Comic Sans MS</option>
    </select>
  </div>
  <!-- Заголовок статьи и кнопки -->
  <div style="max-width: 800px; margin: 2rem auto 1rem; padding: 0 1rem; display: flex; justify-content: space-between; align-items: center;">
    <h1 id="articleTitle" contenteditable="false" style="margin:0; font-size: 2.5rem; font-weight: 700;" tabindex="0" aria-label="Заголовок статьи" data-placeholder="Введите заголовок..."></h1>
    <div>
      <button id="editBtn" type="button" style="font-size: 1.25rem; padding: 0.5rem 1rem; cursor: pointer;">
        <i class="fas fa-pencil-alt"></i> Редактировать
      </button>
      <button id="saveBtn" type="button" style="font-size: 1.25rem; padding: 0.5rem 1rem; cursor: pointer; display: none;">
        <i class="fas fa-save"></i> Сохранить
      </button>
    </div>
  </div>
  <!-- Контент статьи -->
  <main>
    <article id="articleContent" class="content-editable empty" contenteditable="false" style="max-width: 800px; margin: 0 auto 3rem; background: white;" tabindex="0" aria-label="Контент статьи" data-placeholder="Введите текст статьи..."></article>
  </main>
<script>
  const ADMIN_CODE = "123";
  // Элементы DOM
  const adminModal = document.getElementById("adminModal");
  const adminCodeInput = document.getElementById("adminCodeInput");
  const adminError = document.getElementById("adminError");
  const adminSubmitBtn = document.getElementById("adminSubmitBtn");
  const editBtn = document.getElementById("editBtn");
  const saveBtn = document.getElementById("saveBtn");
  const articleContent = document.getElementById("articleContent");
  const articleTitle = document.getElementById("articleTitle");
  const editorToolbar = document.getElementById("editorToolbar");
  const fontSizeDisplay = document.getElementById("fontSizeDisplay");
  const fontSizeInput = document.getElementById("fontSizeInput");
  let isAdmin = false;

  function showAdminModal() {
    adminModal.classList.add("active");
    adminModal.setAttribute('aria-hidden', 'false');
    adminCodeInput.value = "";
    adminError.style.display = "none";
    adminCodeInput.focus();
  }

  function hideAdminModal() {
    adminModal.classList.remove("active");
    adminModal.setAttribute('aria-hidden', 'true');
  }

  adminSubmitBtn.addEventListener("click", () => {
    if (adminCodeInput.value === ADMIN_CODE) {
      isAdmin = true;
      sessionStorage.setItem("isAdmin", "true");
      hideAdminModal();
      enableEditing();
    } else {
      adminError.style.display = "block";
      adminCodeInput.setAttribute('aria-invalid', 'true');
    }
  });

  function enableEditing() {
    articleContent.contentEditable = "true";
    articleTitle.contentEditable = "true";
    editorToolbar.classList.add("active");
    editBtn.style.display = "none";
    saveBtn.style.display = "inline-block";
    updatePlaceholderClass();
    updateFontSizeDisplay();
    articleTitle.focus();
  }

  function disableEditing() {
    articleContent.contentEditable = "false";
    articleTitle.contentEditable = "false";
    editorToolbar.classList.remove("active");
    editBtn.style.display = "inline-block";
    saveBtn.style.display = "none";
    updatePlaceholderClass();
  }

  function formatText(command, value = null) {
    document.execCommand(command, false, value);
    articleContent.focus();
  }

  // Функция для получения текущего размера шрифта из выделения
  function getCurrentFontSize() {
    const selection = window.getSelection();
    if (!selection.rangeCount || selection.isCollapsed) {
      return 16; // Дефолтный размер
    }

    const parent = selection.focusNode.parentElement;
    const computedStyle = window.getComputedStyle(parent);
    const fontSize = computedStyle.fontSize;
    return parseInt(fontSize) || 16;
  }

  // Функция для установки размера шрифта на выделение
  function setFontSize(size) {
    const selection = window.getSelection();
    if (!selection.rangeCount || selection.isCollapsed) return;

    const range = selection.getRangeAt(0);

    // Создаем span с нужным размером
    const span = document.createElement('span');
    span.style.fontSize = size + 'px';

    try {
      range.surroundContents(span);
    } catch (e) {
      // Fallback: используем execCommand и заменяем font[size]
      document.execCommand('fontSize', false, '7');
      replaceFontSizeWithSpan(size);
    }

    articleContent.focus();
    updateFontSizeDisplay();
  }

  function replaceFontSizeWithSpan(pxSize) {
    const fonts = articleContent.querySelectorAll('font[size="7"]');
    fonts.forEach(fontEl => {
      const span = document.createElement('span');
      span.style.fontSize = pxSize + 'px';
      span.innerHTML = fontEl.innerHTML;
      fontEl.parentNode.replaceChild(span, fontEl);
    });
  }

  // Обновление отображения размера шрифта
  function updateFontSizeDisplay() {
    const currentSize = getCurrentFontSize();
    fontSizeInput.value = currentSize;
  }

  // Сделать поле редактируемым при клике
  function makeFontSizeEditable() {
    fontSizeInput.readOnly = false;
    fontSizeInput.focus();
    fontSizeInput.select();
  }

  // Обработка ввода размера шрифта
  function applyFontSize() {
    fontSizeInput.readOnly = true;
    const size = parseInt(fontSizeInput.value);
    if (size && size >= 8 && size <= 72) {
      setFontSize(size);
    } else {
      updateFontSizeDisplay(); // Восстановить предыдущее значение
    }
  }

  function handleFontSizeKeyDown(event) {
    if (event.key === 'Enter') {
      applyFontSize();
    }
  }

  function addImage() {
    const url = prompt("Введите URL изображения", "https://");
    if (url) {
      formatText("insertImage", url);
    }
  }

  editBtn.addEventListener("click", () => {
    if (isAdmin) {
      enableEditing();
    } else {
      showAdminModal();
    }
  });

  // Функция сохранения страницы
  function saveAndDownload() {
    disableEditing();
    setTimeout(() => {
      const docHtml = "<!DOCTYPE html>\n" + document.documentElement.outerHTML;
      const blob = new Blob([docHtml], { type: "text/html" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      const filename = articleTitle.innerText.trim()
        .replace(/\s+/g, "_")
        .replace(/[^\w\-]/g, "") || "article";
      a.download = filename + ".html";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      alert("Файл страницы успешно сохранён!");
    }, 300);
  }

  saveBtn.addEventListener("click", saveAndDownload);

  // Обновление класса empty для плейсхолдера
  function updatePlaceholderClass() {
    [articleTitle, articleContent].forEach(el => {
      if (el.innerText.trim().length === 0) {
        el.classList.add("empty");
      } else {
        el.classList.remove("empty");
      }
    });
  }

  [articleTitle, articleContent].forEach(el => {
    el.addEventListener("input", updatePlaceholderClass);
    el.addEventListener("focus", updatePlaceholderClass);
    el.addEventListener("blur", updatePlaceholderClass);
  });

  // Обновление размера шрифта при изменении выделения
  articleContent.addEventListener("mouseup", updateFontSizeDisplay);
  articleContent.addEventListener("keyup", updateFontSizeDisplay);

  window.addEventListener("DOMContentLoaded", () => {
    if (sessionStorage.getItem("isAdmin") === "true") {
      isAdmin = true;
      enableEditing();
    }
    updatePlaceholderClass();
    updateFontSizeDisplay();
  });
</script>
</body>
</html>
